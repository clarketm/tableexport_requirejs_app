/*!
 * TableExport.js 4.0.0-alpha.1 (https://www.travismclarke.com)
 * Copyright 2016 Travis Clarke
 * Licensed under the MIT license
 */
!function(t,e){"function"==typeof define&&define.amd?define(["exports","jquery","blobjs","file-saver","xlsx"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("jquery"),require("blobjs"),require("file-saver"),require("xlsx")):e(t,t.jQuery,t.Blob,t.saveAs,t.XLSX)}(this,function(t,e,o,n,r){"use strict";function i(){for(var t=arguments,e=1;e<t.length;e++)for(var o in t[e])t[e].hasOwnProperty(o)&&(t[0][o]=t[e][o]);return t[0]}function s(t){return[].slice.call(t)}function a(t,e,o){for(var n=0;n<t.length;++n)t[n].addEventListener(e,o,!1)}function l(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.cls)}var p=function(t,e,o){var n=this;n.settings=o?e:i({},p.prototype.defaults,e),n.selectors=s(t);var f,u,c,x=p.prototype.rowDel,y=n.settings.ignoreRows instanceof Array?n.settings.ignoreRows:[n.settings.ignoreRows],m=n.settings.ignoreCols instanceof Array?n.settings.ignoreCols:[n.settings.ignoreCols],d=n.settings.ignoreCSS instanceof Array?n.settings.ignoreCSS.join(", "):n.settings.ignoreCSS,g=n.settings.emptyCSS instanceof Array?n.settings.emptyCSS.join(", "):n.settings.emptyCSS;n.settings.bootstrap?(f=p.prototype.bootstrap[0]+" ",u=p.prototype.bootstrap[1]+" ",c=p.prototype.bootstrap[2]+" "):(f=p.prototype.defaultButton+" ",u=c=""),n.selectors.forEach(function(t){function e(e){var o=t.querySelectorAll("caption:not(.head)");o.length?o[0].appendChild(e):(o=document.createElement("caption"),o.className=c+n.settings.position,o.appendChild(e),t.insertBefore(o,t.firstChild))}function i(t,o,n){var r=document.createElement("button");r.setAttribute("data-fileblob",t),r.className=f+u+n,r.textContent=o,e(r)}var a=t.querySelectorAll("caption:not(.head)");o&&a.parentNode.removeChild(a);var b=s(t.querySelectorAll("tbody > tr")),b=n.settings.headings?s(t.querySelectorAll("thead > tr")).concat(b):b,b=n.settings.footers?s(t.querySelectorAll("tfoot > tr")).concat(b):b,h=n.settings.headings?t.querySelectorAll("thead > tr").length:0,v="id"===n.settings.fileName?t.getAttribute("id")?t.getAttribute("id"):p.prototype.defaultFileName:n.settings.fileName,S={xlsx:function(t,e){var o={},n=s(b).map(function(t,e){if(!~y.indexOf(e-h)&&!l(t,d)){var n=t.querySelectorAll("th, td");return s(n).map(function(t,n){if(!~m.indexOf(n)&&!l(t,d)){if(l(t,g))return" ";if(t.hasAttribute("colspan")&&(o[e]=o[e]||{},o[e][n+1]=t.getAttribute("colspan")-1),t.hasAttribute("rowspan"))for(var r=1;r<t.getAttribute("rowspan");r++)o[e+r]=o[e+r]||{},o[e+r][n]=1;return o[e]&&o[e][n]?new Array(o[e][n]).concat(t.textContent):t.textContent}})}}),r=p.prototype.escapeHtml(JSON.stringify({data:n,fileName:e,mimeType:p.prototype.xlsx.mimeType,fileExtension:p.prototype.xlsx.fileExtension})),a=p.prototype.xlsx.buttonContent,f=p.prototype.xlsx.defaultClass;i(r,a,f)},xlsm:function(t,e){var o={},n=s(b).map(function(t,e){if(!~y.indexOf(e-h)&&!l(t,d)){var n=t.querySelectorAll("th, td");return s(n).map(function(t,n){if(!~m.indexOf(n)&&!l(t,d)){if(l(t,g))return" ";if(t.hasAttribute("colspan")&&(o[e]=o[e]||{},o[e][n+1]=t.getAttribute("colspan")-1),t.hasAttribute("rowspan"))for(var r=1;r<t.getAttribute("rowspan");r++)o[e+r]=o[e+r]||{},o[e+r][n]=1;return o[e]&&o[e][n]?new Array(o[e][n]).concat(t.textContent):t.textContent}})}}),r=p.prototype.escapeHtml(JSON.stringify({data:n,fileName:e,mimeType:p.prototype.xls.mimeType,fileExtension:p.prototype.xls.fileExtension})),a=p.prototype.xls.buttonContent,f=p.prototype.xls.defaultClass;i(r,a,f)},xls:function(t,e){var o=p.prototype.xls.separator,n=s(b).map(function(t,e){if(!~y.indexOf(e-h)&&!l(t,d)){var n=t.querySelectorAll("th, td");return s(n).map(function(t,e){if(!~m.indexOf(e)&&!l(t,d))return l(t,g)?" ":t.textContent}).join(o)}}).join(t),r=p.prototype.escapeHtml(JSON.stringify({data:n,fileName:e,mimeType:p.prototype.xls.mimeType,fileExtension:p.prototype.xls.fileExtension})),a=p.prototype.xls.buttonContent,f=p.prototype.xls.defaultClass;i(r,a,f)},csv:function(t,e){var o=p.prototype.csv.separator,n=s(b).map(function(t,e){if(!~y.indexOf(e-h)&&!l(t,d)){var n=t.querySelectorAll("th, td");return s(n).map(function(t,e){if(!~m.indexOf(e)&&!l(t,d))return l(t,g)?" ":'"'+t.textContent.replace(/"/g,'""')+'"'}).join(o)}}).join(t),r=p.prototype.escapeHtml(JSON.stringify({data:n,fileName:e,mimeType:p.prototype.csv.mimeType,fileExtension:p.prototype.csv.fileExtension})),a=p.prototype.csv.buttonContent,f=p.prototype.csv.defaultClass;i(r,a,f)},txt:function(t,e){var o=p.prototype.txt.separator,n=s(b).map(function(t,e){if(!~y.indexOf(e-h)&&!l(t,d)){var n=t.querySelectorAll("th, td");return s(n).map(function(t,e){if(!~m.indexOf(e)&&!l(t,d))return l(t,g)?" ":t.textContent}).join(o)}}).join(t),r=p.prototype.escapeHtml(JSON.stringify({data:n,fileName:e,mimeType:p.prototype.txt.mimeType,fileExtension:p.prototype.txt.fileExtension})),a=p.prototype.txt.buttonContent,f=p.prototype.txt.defaultClass;i(r,a,f)}};n.settings.formats.forEach(function(t){!(!r||"xls"!==t)&&(t="xlsm"),!r&&"xlsx"===t&&(t=null),t&&S[t](x,v)})});var b=document.querySelectorAll("button[data-fileblob]");return a(b,"click",function(){var t=JSON.parse(this.getAttribute("data-fileblob")),e=t.data,o=t.fileName,n=t.mimeType,r=t.fileExtension;p.prototype.export2file(e,n,o,r)}),n};if(p.prototype={defaults:{headings:!0,footers:!0,formats:["xls","csv","txt"],fileName:"id",bootstrap:!0,position:"bottom",ignoreRows:null,ignoreCols:null,ignoreCSS:".tableexport-ignore",emptyCSS:".tableexport-empty"},charset:"charset=utf-8",defaultFileName:"myDownload",defaultButton:"button-default",bootstrap:["btn","btn-default","btn-toolbar"],rowDel:"\r\n",entityMap:{"&":"&#38;","<":"&#60;",">":"&#62;","'":"&#39;","/":"&#47;"},xlsx:{defaultClass:"xlsx",buttonContent:"Export to xlsx",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",fileExtension:".xlsx"},xls:{defaultClass:"xls",buttonContent:"Export to xls",separator:"\t",mimeType:"application/vnd.ms-excel",fileExtension:".xls"},csv:{defaultClass:"csv",buttonContent:"Export to csv",separator:",",mimeType:"text/csv",fileExtension:".csv"},txt:{defaultClass:"txt",buttonContent:"Export to txt",separator:"  ",mimeType:"text/plain",fileExtension:".txt"},escapeHtml:function(t){return String(t).replace(/[&<>'\/]/g,function(t){return p.prototype.entityMap[t]})},dateNum:function(t,e){e&&(t+=1462);var o=Date.parse(t);return(o-new Date(Date.UTC(1899,11,30)))/864e5},createSheet:function(t){for(var e={},o={s:{c:1e7,r:1e7},e:{c:0,r:0}},n=0;n!=t.length;++n)for(var i=0;i!=t[n].length;++i){o.s.r>n&&(o.s.r=n),o.s.c>i&&(o.s.c=i),o.e.r<n&&(o.e.r=n),o.e.c<i&&(o.e.c=i);var s={v:t[n][i]};if(null!=s.v){var a=r.utils.encode_cell({c:i,r:n});"number"==typeof s.v?s.t="n":"boolean"==typeof s.v?s.t="b":s.v instanceof Date?(s.t="n",s.z=r.SSF._table[14],s.v=this.dateNum(s.v)):s.t="s",e[a]=s}}return o.s.c<1e7&&(e["!ref"]=r.utils.encode_range(o)),e},Workbook:function(){this.SheetNames=[],this.Sheets={}},string2ArrayBuffer:function(t){for(var e=new ArrayBuffer(t.length),o=new Uint8Array(e),n=0;n!=t.length;++n)o[n]=255&t.charCodeAt(n);return e},export2file:function(t,e,i,s){if(r&&".xls"==s.substr(0,4)){var a=new this.Workbook,l=this.createSheet(t);a.SheetNames.push(i),a.Sheets[i]=l;var p={bookType:s.substr(1,3)+(s.substr(4)||"m"),bookSST:!1,type:"binary"},f=r.write(a,p);t=this.string2ArrayBuffer(f)}n(new o([t],{type:e+";"+this.charset}),i+s,!0)},update:function(t){return new p(this.selectors,i({},this.settings,t),(!0))},reset:function(){return new p(this.selectors,settings,(!0))},remove:function(){this.selectors.each(function(){var t=this.querySelectorAll("caption:not(.head)");t.parentNode.removeChild(t)})}},e){e.fn.tableExport=function(t,e){return new p(this,t,e)};for(var f in p.prototype)e.fn.tableExport[f]=p.prototype[f]}t["default"]=t.TableExport=p});